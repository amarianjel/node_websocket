<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Websockets - <small>Status</small></h1>

    <form>
        <input type="text" placeholder="Enviar mensaje" />
        <button>Enviar</button>
    </form>

    <ul id="message">

    </ul>


    <script>
        const form = document.querySelector('form');
        const input = document.querySelector('input');
        const ulListElements = document.querySelector('#message');
        const statusElement = document.querySelector('small')

        console.log("Hola desde el Front")
        

        function connetToServer() {

            const socket = new WebSocket("ws://localhost:3000")

            function sendMessage(message) {
                //console.log({message});
                socket.send(message);
            }

            function renderMessage(message) {
                const li = document.createElement("li");
                li.innerHTML = message;
                ulListElements.prepend(li);
            }

            form.addEventListener('submit', (event) => {
                event.preventDefault();
                const message = input.value;
                sendMessage(message);
            })

            socket.onopen = (event) => {
                console.log('Connection established');
                statusElement.innerText = 'Online';
            }

            socket.onclose = (event) => {
                console.log("Disconnect");
                statusElement.innerText = 'Offline'
                setTimeout(() => {
                    connetToServer()
                }, 15000);
            }

            socket.onmessage = (event) => {
                const { payload } = JSON.parse(event.data)
                renderMessage( payload );
            }
        }

        connetToServer()
    </script>
</body>
</html>